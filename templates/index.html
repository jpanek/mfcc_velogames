<!-- templates/index.html -->
{% extends 'base.html' %}

{% block title %}MFCC Velogames{% endblock %}

{% block content %}

<h3 class="mt-3">Upcoming races</h3>

<div class="row">
    <div class="col-12 col-lg-8 mx-auto">
        <div class="table-responsive">
            <table class="table table-bordered table-hover mt-2 w-auto mx-auto">
                <thead class="table-primary text-center">
                    <tr>
                        {% for column in columns[2:] %}
                            <th class="text-nowrap">{{ column }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for row in data %}
                        <tr data-url="{{ url_for('main.stage') }}?stage_id={{ row['stage_id'] }}" 
                            onclick="redirectToLink(this)" 
                            class="{% if row['warning'] == 1 %}table-warning{% endif %}" 
                            style="cursor: pointer;">
                            {% for cell in row[2:] %}
                                <td class="{% if cell is number %}numeric{% endif %} text-nowrap" 
                                    style="text-align: {% if cell is number %}right{% else %}left{% endif %};">
                                    {{ "{:,.0f}".format(cell) if cell is number else cell }}
                                </td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<h3 class="mt-5">Overall teams</h3>

<div class="row">
    <div class="col-12 col-lg-8 mx-auto">
        <div class="table-responsive">
            <table class="table table-bordered table-hover mt-2 w-auto mx-auto">
                <thead class="table-primary text-center">
                    <tr>
                        {% for column in columns_2 %}
                            <th class="text-nowrap">{{ column }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for row in data_2 %}
                        <tr>
                            {% for cell in row %}
                                <td class="{% if cell is number %}numeric{% endif %} text-nowrap" 
                                    style="text-align: {% if cell is number %}right{% else %}left{% endif %};">
                                    {{ "{:,.0f}".format(cell) if cell is number else cell }}
                                </td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

    <!-- Scatter plot here: -->
    <div class="container">
        <div class="row justify-content-center">
          <div class="col-10 col-md-11">
            <canvas id="scatterChart" style="width: 100%; height: 500px;"></canvas>
          </div>
        </div>
    </div>

    <!-- Function: Scatter plot for Riders --> 
    <script>
        const chartData = {{ chart_data|safe }};

        const ctx = document.getElementById('scatterChart').getContext('2d');
        new Chart(ctx, {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'Cost vs Points',
                    data: chartData,
                    backgroundColor: 'rgba(255, 99, 132, 0.6)',
                    pointRadius: 7,
                    pointHoeverRadius: 10,
                    borderColor: 'rgba(255, 99, 132, 1)'
                }]
            },
            options: {
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const point = context.raw;
                                return `${point.label}: (${point.x}, ${point.y})`;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        title: { display: true, text: 'Cost' }
                    },
                    y: {
                        title: { display: true, text: 'Points' }
                    }
                }
            }
        });
    </script>

    <!-- Function: Redirect to link -->
    <script>
        function redirectToLink(row) {
            window.location.href = row.getAttribute("data-url");
        }
    </script>
{% endblock %}

<!-- -->